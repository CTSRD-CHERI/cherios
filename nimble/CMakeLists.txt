set(MYNEWT_NIMBLE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/mynewt-nimble)

include_directories(
    ${MYNEWT_NIMBLE_DIR}/nimble/include
    ${MYNEWT_NIMBLE_DIR}/nimble/controller/include
    ${MYNEWT_NIMBLE_DIR}/nimble/drivers/native/include
    ${MYNEWT_NIMBLE_DIR}/nimble/host/include
    ${MYNEWT_NIMBLE_DIR}/nimble/host/store/ram/include/
    ${MYNEWT_NIMBLE_DIR}/nimble/host/util/include
    ${MYNEWT_NIMBLE_DIR}/nimble/host/services/ans/include/
    ${MYNEWT_NIMBLE_DIR}/nimble/host/services/bas/include/
    ${MYNEWT_NIMBLE_DIR}/nimble/host/services/bleuart/include/
    ${MYNEWT_NIMBLE_DIR}/nimble/host/services/dis/include/
    ${MYNEWT_NIMBLE_DIR}/nimble/host/services/gap/include/
    ${MYNEWT_NIMBLE_DIR}/nimble/host/services/gatt/include/
    ${MYNEWT_NIMBLE_DIR}/nimble/host/services/ias/include/
    ${MYNEWT_NIMBLE_DIR}/nimble/host/services/lls/include/
    ${MYNEWT_NIMBLE_DIR}/nimble/host/services/tps/include/
    ${MYNEWT_NIMBLE_DIR}/porting/nimble/include
    porting/npl/cherios/include
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/include/
)

# `find mynewt-nimble/nimble/ -name "*.c"`
set(NIMBLE_LIB_CORE_SRCS
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_sched.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_rand.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_utils.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_adv.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_conn.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_resolv.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_supp_cmd.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_whitelist.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_sync.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_rfmgmt.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_conn_hci.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_ctrl.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_hci.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_hci_ev.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_scan.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_trace.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/src/ble_ll_dtm.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/test/src/ble_ll_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/controller/test/src/ble_ll_csa2_test.c
${MYNEWT_NIMBLE_DIR}/nimble/host/store/ram/src/ble_store_ram.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/store/config/src/ble_store_config_conf.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/store/config/src/ble_store_config.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_att_svr.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_ibeacon.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_hci.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_gattc.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_gap.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_atomic.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_sm_cmd.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_shutdown.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_hci_evt.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_l2cap.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_sm_sc.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_monitor.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_startup.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_mbuf.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_stop.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_periodic_sync.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_hci_cmd.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_sm_lgcy.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_att_clt.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_att.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_flow.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_log.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_cfg.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_hci_util.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_gatts_lcl.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_l2cap_sig.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_eddystone.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_l2cap_sig_cmd.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_misc.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_conn.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_id.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_store.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_sm.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_pvcy.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_gatts.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_l2cap_coc.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_sm_alg.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_mqueue.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_hs_adv.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_uuid.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_store_util.c
${MYNEWT_NIMBLE_DIR}/nimble/host/src/ble_att_cmd.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/prov.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/cfg_srv.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/crypto.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/friend.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/lpn.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/proxy.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/net.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/mesh.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/health_srv.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/shell.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/glue.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/cfg_cli.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/testing.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/transport.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/health_cli.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/model_cli.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/light_model.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/beacon.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/adv.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/access.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/settings.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/model_srv.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/mesh/src/nodes.c
${MYNEWT_NIMBLE_DIR}/nimble/host/services/gatt/src/ble_svc_gatt.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/services/ias/src/ble_svc_ias.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/services/ans/src/ble_svc_ans.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/services/dis/src/ble_svc_dis.c
${MYNEWT_NIMBLE_DIR}/nimble/host/services/gap/src/ble_svc_gap.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/services/bleuart/src/bleuart.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/services/lls/src/ble_svc_lls.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/services/ipss/src/ble_svc_ipss.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/services/bas/src/ble_svc_bas.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/services/tps/src/ble_svc_tps.c
${MYNEWT_NIMBLE_DIR}/nimble/host/util/src/addr.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_hs_conn_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatt_disc_s_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatts_reg_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_hs_hci_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatts_read_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_sm_lgcy_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_os_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_l2cap_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatt_read_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatt_find_s_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_store_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_sm_test_util.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatt_disc_c_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatt_write_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_hs_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_hs_stop_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gap_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_att_clt_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_hs_pvcy_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatt_conn_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatt_disc_d_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_hs_id_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_gatts_notify_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_sm_sc_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_att_svr_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_hs_test_util_hci.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_hs_adv_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_uuid_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_hs_test_util.c
#${MYNEWT_NIMBLE_DIR}/nimble/host/test/src/ble_sm_test.c
#${MYNEWT_NIMBLE_DIR}/nimble/transport/da1469x/cmac_driver/src/cmac_host.c
#${MYNEWT_NIMBLE_DIR}/nimble/transport/da1469x/src/da1469x_ble_hci.c
#${MYNEWT_NIMBLE_DIR}/nimble/transport/emspi/src/ble_hci_emspi.c
#${MYNEWT_NIMBLE_DIR}/nimble/transport/socket/src/ble_hci_socket.c
#${MYNEWT_NIMBLE_DIR}/nimble/transport/uart/src/ble_hci_uart.c
#${MYNEWT_NIMBLE_DIR}/nimble/transport/ram/src/ble_hci_ram.c
#${MYNEWT_NIMBLE_DIR}/nimble/drivers/nrf51/src/ble_hw.c
#${MYNEWT_NIMBLE_DIR}/nimble/drivers/nrf51/src/ble_phy.c
#${MYNEWT_NIMBLE_DIR}/nimble/drivers/native/src/ble_hw.c
#${MYNEWT_NIMBLE_DIR}/nimble/drivers/native/src/ble_phy.c
#${MYNEWT_NIMBLE_DIR}/nimble/drivers/nrf52/src/ble_hw.c
#${MYNEWT_NIMBLE_DIR}/nimble/drivers/nrf52/src/ble_phy_trace.c
#${MYNEWT_NIMBLE_DIR}/nimble/drivers/nrf52/src/ble_phy.c
)

set(NIMBLE_LIB_PORTING_SRCS
    ${MYNEWT_NIMBLE_DIR}/porting/nimble/src/endian.c
    #${MYNEWT_NIMBLE_DIR}/porting/nimble/src/hal_timer.c
    ${MYNEWT_NIMBLE_DIR}/porting/nimble/src/mem.c
    ${MYNEWT_NIMBLE_DIR}/porting/nimble/src/nimble_port.c
    #${MYNEWT_NIMBLE_DIR}/porting/nimble/src/os_cputime.c
    #${MYNEWT_NIMBLE_DIR}/porting/nimble/src/os_cputime_pwr2.c
    ${MYNEWT_NIMBLE_DIR}/porting/nimble/src/os_mbuf.c
    ${MYNEWT_NIMBLE_DIR}/porting/nimble/src/os_mempool.c
    ${MYNEWT_NIMBLE_DIR}/porting/nimble/src/os_msys_init.c

    porting/npl/cherios/src/npl_os_dummy.c
    porting/npl/cherios/src/os_eventq.cc
    porting/npl/cherios/src/os_mutex.c
    porting/npl/cherios/src/os_task.c
    porting/npl/cherios/src/hci_dummy.c
    porting/npl/cherios/src/realloc.c
    porting/npl/cherios/src/strncpy.c
)

set(NIMBLE_TINYCRYPT_SRCS
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/hmac.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/hmac_prng.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/cbc_mode.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/utils.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/aes_encrypt.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/aes_decrypt.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/sha256.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/ecc.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/ctr_mode.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/ccm_mode.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/ctr_prng.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/cmac_mode.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/ecc_dsa.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/ecc_platform_specific.c
    ${MYNEWT_NIMBLE_DIR}/ext/tinycrypt/src/ecc_dh.c
)

set(NIMBLE_SRCS
    ${INIT_ASM}
    ${NIMBLE_LIB_CORE_SRCS}
    ${NIMBLE_LIB_PORTING_SRCS}
    ${NIMBLE_TINYCRYPT_SRCS}
    src/main.c
    src/ble_demo.c
)

add_cherios_executable(nimble ADD_TO_FILESYSTEM NEED_LIBCXX LINKER_SCRIPT sandbox.ld SOURCES ${NIMBLE_SRCS})

target_compile_options(nimble PRIVATE
    -Wno-unused-parameter
    -Wno-sign-compare
    -Wno-incompatible-pointer-types-discards-qualifiers
    -Wno-error=unused-command-line-argument
    -Wno-user-defined-literals
    -Wno-cast-qual
    -Wno-pointer-arith
)
